name: GitHub to Discord
on:
  push:
    branches: [main]  # –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑ —ç—Ç–∏—Ö –≤–µ—Ç–æ–∫

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Extract commit title and description
        id: extract_commit
        run: |
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          # –†–∞–∑–¥–µ–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
          COMMIT_TITLE=$(echo "$COMMIT_MESSAGE" | head -n 1)
          COMMIT_DESCRIPTION=$(echo "$COMMIT_MESSAGE" | tail -n +2 | sed ':a;N;$!ba;s/\n/\\n/g')
          
          echo "Commit Title: $COMMIT_TITLE"
          echo "Commit Description: $COMMIT_DESCRIPTION"
          
          # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è
          echo "TITLE=$COMMIT_TITLE" >> $GITHUB_ENV
          echo "DESCRIPTION=$COMMIT_DESCRIPTION" >> $GITHUB_ENV
      
      - name: Send Embed to Discord
        run: |
          echo "Sending webhook with title: ${{ env.TITLE }} and description: ${{ env.DESCRIPTION }}"
          curl -X POST "$DISCORD_WEBHOOK" \
          -H "Content-Type: application/json" \
          -d '{
            "username": "D2_MODDING_UPDATES",
            "avatar_url": "https://i.imgur.com/BCTrM9E.png",
            "embeds": [{
              "title": "",
              "description": "## üöÄ –ù–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è!\n### ${{ env.TITLE }}\n${{ env.DESCRIPTION }}",
              "color": 16754740,
              "fields": [],
              "footer": {
                "text": "Update by ${{ github.event.head_commit.author.name }}",
                "icon_url": "https://avatars.githubusercontent.com/${{ github.actor }}"
              },
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }]
          }'
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}

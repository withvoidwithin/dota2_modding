name: GitHub to Discord
on:
  push:
    branches: [main]  # ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¸Ð· ÑÑ‚Ð¸Ñ… Ð²ÐµÑ‚Ð¾Ðº  

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Embed to Discord
        run: |
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          COMMIT_TITLE=$(echo "$COMMIT_MESSAGE" | head -n 1)
          COMMIT_BODY=$(echo "$COMMIT_MESSAGE" | tail -n +2)
          echo "COMMIT_TITLE=$COMMIT_TITLE" >> $GITHUB_ENV
          echo "COMMIT_BODY=$COMMIT_BODY" >> $GITHUB_ENV

          PAYLOAD=$(cat <<EOF
          {
            "username": "D2_MODDING_UPDATES",
            "avatar_url": "https://i.imgur.com/BCTrM9E.png",
            "embeds": [{
              "title": "",
              "description": "## ðŸš€ ÐÐ¾Ð²Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ!\n### $COMMIT_TITLE\n$COMMIT_BODY",
              "color": 11378687,
              "fields": [],
              "author": {
                "name": "${{ github.event.head_commit.author.name }}",
                "url": "https://github.com/withvoidwithin/dota2_modding"
              },
              "footer": {
                "text": "Update by ${{ github.event.head_commit.author.name }}",
                "icon_url": "https://avatars.githubusercontent.com/${{ github.actor }}"
              },
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }]
          }
          EOF
          )

          curl -X POST "$DISCORD_WEBHOOK" \
          -H "Content-Type: application/json" \
          -d "$PAYLOAD"
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}

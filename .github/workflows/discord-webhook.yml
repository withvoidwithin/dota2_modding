name: GitHub to Discord
on:
  push:
    branches: [main]  # –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–∑ —ç—Ç–∏—Ö –≤–µ—Ç–æ–∫  

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Embed to Discord
        run: |
          COMMIT_MESSAGE="${{ github.event.head_commit.message }}"
          COMMIT_TITLE=$(echo "$COMMIT_MESSAGE" | head -n 1)
          COMMIT_BODY=$(echo "$COMMIT_MESSAGE" | tail -n +2)
          echo "COMMIT_TITLE=$COMMIT_TITLE" >> $GITHUB_ENV
          echo "COMMIT_BODY=$COMMIT_BODY" >> $GITHUB_ENV
          curl -X POST "$DISCORD_WEBHOOK" \
          -H "Content-Type: application/json" \
          -d "$(echo '{
            "username": "D2_MODDING_UPDATES",
            "avatar_url": "https://i.imgur.com/BCTrM9E.png",
            "embeds": [{
              "title": "üöÄ –ù–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è!",
              "description": "## üöÄ –ù–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è!\n### '${{ env.COMMIT_TITLE }}'\n${{ env.COMMIT_BODY }}",
              "color": 11378687,
              "fields": [],
              "author": {
                "name": "${{ github.event.head_commit.author.name }}",
                "url": "https://github.com/withvoidwithin/dota2_modding"
              },
              "footer": {
                "text": "Update by ${{
                github.event.head_commit.author.name }}",
                "icon_url": "https://avatars.githubusercontent.com/${{ github.actor }}"
              },
              "timestamp": "${{ github.event.head_commit.timestamp }}"
            }]
          }')" 
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
